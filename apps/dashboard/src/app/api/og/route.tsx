/* eslint-env node */
import { ImageResponse } from "@vercel/og";
import type { NextRequest } from "next/server";

export const runtime = "edge";

const font = fetch("https://cdn.metrik.app/Inter-SemiBold.ttf").then((res) =>
  res.arrayBuffer(),
);

export async function GET(req: NextRequest) {
  const inter = await font;

  const { searchParams } = new URL(req.url);

  // ?title=<title>
  const hasTitle = searchParams.has("title");
  const title = hasTitle ? searchParams.get("title")?.slice(0, 100) : "Metrik";

  return new ImageResponse(
    (
      <div
        style={{
          height: "100%",
          width: "100%",
          display: "flex",
          flexDirection: "column",
          alignItems: "flex-start",
          justifyContent: "center",
          padding: 80,
          backgroundColor: "#fff",
          //   backgroundImage:
          //     "radial-gradient(circle at 25px 25px, #333 2%, transparent 0%), radial-gradient(circle at 75px 75px, #333 2%, transparent 0%)",
          backgroundSize: "100px 100px",
          backgroundPosition: "-30px -10px",
          fontWeight: 700,
          color: "black",
        }}
      >
        <svg
          style={{ position: "absolute", top: 70, left: 80 }}
          xmlns="http://www.w3.org/2000/svg"
          version="1.0"
          viewBox="0 0 1500.000000 1500.000000"
          preserveAspectRatio="xMidYMid meet"
          height="60"
          width="60"
        >
          <g
            transform="translate(0.000000,1500.000000) scale(0.100000,-0.100000)"
            fill="black"
            stroke="none"
          >
            <path d="M7080 14940 c-277 -14 -572 -50 -975 -120 -125 -21 -463 -101 -660 -157 -89 -24 -491 -156 -530 -172 -11 -5 -81 -33 -155 -61 -240 -94 -737 -327 -860 -405 -22 -14 -42 -25 -45 -25 -3 0 -22 -11 -43 -24 -20 -12 -100 -61 -177 -106 -77 -46 -145 -88 -151 -94 -7 -6 -33 -24 -60 -39 l-47 -29 945 -945 945 -945 82 41 c487 245 1052 408 1656 478 212 25 778 25 990 0 532 -61 995 -184 1454 -384 127 -55 357 -169 421 -208 19 -12 64 -39 100 -60 209 -124 470 -310 677 -484 114 -96 448 -430 544 -544 162 -193 380 -495 463 -642 9 -16 32 -55 50 -85 173 -286 386 -793 471 -1125 7 -27 22 -84 33 -125 24 -91 66 -300 87 -434 35 -223 47 -379 51 -671 5 -446 -29 -764 -127 -1190 -56 -241 -161 -559 -261 -790 -50 -117 -200 -420 -209 -423 -5 -2 -9 -8 -9 -13 0 -13 -144 -253 -213 -354 -70 -102 -219 -302 -264 -355 -256 -296 -432 -475 -637 -646 -202 -169 -445 -346 -599 -435 -245 -143 -463 -255 -632 -324 -49 -20 -103 -43 -120 -50 -108 -48 -485 -166 -650 -204 -185 -42 -409 -83 -530 -95 -27 -3 -99 -11 -160 -18 -145 -17 -734 -17 -870 -1 -55 7 -125 15 -155 18 -125 13 -346 53 -535 96 -165 38 -542 156 -650 204 -16 7 -69 29 -117 49 -48 20 -140 61 -204 92 l-117 56 -945 -945 -945 -945 99 -64 c54 -36 115 -74 134 -86 352 -210 710 -390 1040 -524 69 -27 139 -56 155 -63 84 -36 516 -181 630 -211 410 -109 810 -191 1100 -224 50 -5 130 -15 179 -20 158 -19 556 -40 766 -40 210 0 608 21 766 40 49 5 130 15 179 21 305 36 708 117 1100 223 136 37 538 171 630 211 17 7 93 39 170 70 248 102 267 111 470 214 317 160 470 248 763 435 127 81 482 338 542 392 14 12 88 73 164 136 260 211 701 652 931 932 245 297 492 642 641 893 90 153 118 201 167 288 78 141 231 451 284 575 24 58 50 119 58 135 12 27 33 80 111 280 130 336 284 903 349 1285 9 52 20 120 25 150 13 76 46 342 60 480 37 389 37 958 -1 1370 -74 799 -278 1583 -611 2340 -50 114 -214 447 -258 525 -186 330 -422 703 -527 833 -19 24 -65 83 -102 132 -463 618 -1158 1267 -1811 1690 -41 27 -79 53 -85 57 -20 17 -242 150 -400 240 -197 113 -616 311 -855 404 -85 33 -164 65 -175 69 -37 17 -439 148 -530 173 -197 56 -535 136 -660 157 -575 99 -924 131 -1425 128 -135 -1 -310 -4 -390 -8z" />
            <path d="M1179 11438 c-66 -107 -131 -216 -219 -373 -86 -152 -251 -502 -358 -760 -255 -613 -446 -1401 -511 -2105 -38 -416 -39 -965 -1 -1370 37 -393 100 -760 200 -1160 55 -220 116 -423 189 -625 74 -209 125 -341 161 -420 5 -11 29 -67 53 -125 80 -189 252 -524 384 -750 86 -145 271 -437 282 -444 4 -3 429 417 945 933 l939 939 -86 173 c-104 212 -142 300 -203 466 -118 324 -201 640 -250 963 -69 451 -69 1020 1 1466 50 319 129 624 243 945 34 96 140 346 179 423 l25 49 -949 949 -948 948 -76 -122z" />
            <path d="M7290 9784 c-181 -17 -446 -79 -617 -146 -500 -194 -929 -574 -1181 -1043 -124 -232 -199 -455 -249 -735 -25 -147 -25 -559 1 -705 128 -726 538 -1304 1171 -1654 704 -388 1611 -358 2300 77 164 104 353 261 469 390 306 343 491 727 572 1187 26 147 26 559 1 705 -74 421 -218 749 -468 1064 -356 450 -836 735 -1412 837 -109 20 -469 34 -587 23z" />
          </g>
        </svg>

        <p
          style={{
            position: "absolute",
            bottom: 70,
            left: 80,
            margin: 0,
            fontSize: 30,
            letterSpacing: -1,
            color: "#525252",
          }}
        >
          Automated toolkit for Roblox developers
        </p>
        <h1
          style={{
            fontSize: 82,
            margin: "0 0 0 -2px",
            lineHeight: 1.1,

            letterSpacing: -2,

            // backgroundImage: "linear-gradient(90deg, #fff 40%, #aaa)",
            // backgroundClip: "text",

            // WebkitBackgroundClip: "text",
            // color: "transparent",
            color: "black",
          }}
        >
          {title}
        </h1>
      </div>
    ),
    {
      width: 1200,
      height: 630,
      fonts: [
        {
          name: "inter",
          data: inter,
          style: "normal",
        },
      ],
    },
  );
}
